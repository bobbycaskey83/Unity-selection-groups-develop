■ オブジェクトID出力

□ 準備

このファイルを含むディレクトリ全体を Unity プロジェクト内の Assets 下へコピーしてください。


□ 使い方の例

(1) カメラのコピーを作る
(2) コピーしたカメラの Camera > Target Display を Display 3 等に変更
(3) インスペクタなどのウィンドウタブ ("Inspector" というタブ名が常に表示されている部分) を右クリックし、 Add Tab > Game を選択して、 Game View を追加
(4) 追加したゲームビューのタブ直下にある "Display 1" を (2) で指定したディスプレイに変更
(5) コピーしたカメラの Camera > Rendering Path が Deferred になっていることを確認
(6) コピーしたカメラの G Buffer Recorder の Output Dir を元とは異なるディレクトリ名にする (Capture_ObjId など)
(7) コピーしたカメラに ObjectIdRenderer コンポーネントを追加する
(8) Assets ビューから、 CSV ファイルを ObjectIdRenderer > Csv Filename にドラッグ＆ドロップする
(9) コピーしたカメラの G Buffer Recorder の Play ボタンを押し、キャプチャする
(10) エクスプローラーなどで、 Capture_Test/FrameBuffer_*.png にオブジェクトIDが出ていることを確認する


□ CSVファイルのフォーマット

先頭の行に以下の４つのヘッダを追加します

        *PrefabName
        *ColorR
        *ColorG
        *ColorB

それぞれの列の意味は以下となります

        *PrefabName     Prefab名。配置されているGameObjectの元のPrefab名を指定します。
                        「*」「?」によるワイルドカード指定も可能です
        *ColorR         *GameObjectName にマッチしたオブジェクトの色 (R : 0.0～1.0)
        *ColorG         *GameObjectName にマッチしたオブジェクトの色 (G : 0.0～1.0)
        *ColorB         *GameObjectName にマッチしたオブジェクトの色 (B : 0.0～1.0)


□ ObjectIdRenderer コンポーネントのプロパティ

        Replace Shader            描画に用いるシェーダです。通常は None を指定します
        Background Color          「何も描画されない」部分の色を指定します
        Default Color             CSV テーブル上で何にもマッチしなかった「その他」のオブジェクトの色を指定します
        Csv Filename              CSV テーブルを指定します。 Assets ビューから、CSVファイルをドラッグ＆ドロップしてください
        Master Camera             追従するカメラがある場合、そのカメラを指定します
        Pseudo Prefab Root Names  擬似的に Prefabのルートオブジェクトとみなすオブジェクト名のルールを指定します。
                                  Size にルールの個数を指定した後、Element にルールを指定します。
                                  ルール定義時にはワイルドカード「*」および「?」を使用できます。
                                  例えばルートオブジェクトは常に「:pfb_」を含む場合、「*:pfb_*」を指定します。


□ Movie Capture コンポーネントが並置されている場合の特別ルール

本コンポーネントと同一のオブジェクトに Movie Capture コンポーネントが存在する場合、
Render Texture を自動的に設定します。
これにより、カメラの Display 変更を設定せず、キャプチャ結果を出力することができます。

( Movie Capture は https://github.com/unity3d-jp/FrameCapturer 内に含まれるコンポーネントです )
